{% extends 'main_app/base.html' %}

{% block content %}
<!-- Change Password Page - Making it secure and user-friendly -->
<div class="profile-form-container">
    <!-- Header with security icon -->
    <div class="form-header">
        <div class="form-icon">🔒</div>
        <h2>Change Password</h2>
        <p>Keep your account secure with a strong password</p>
    </div>

    <!-- Show any messages from the server -->
    {% if messages %}
        {% for message in messages %}
            <div class="message-alert message-{{ message.tags }}">
                <span class="message-icon">
                    {% if message.tags == 'success' %}✅{% else %}❌{% endif %}
                </span>
                {{ message }}
            </div>
        {% endfor %}
    {% endif %}

    <!-- Password change form -->
    <div class="form-card">
        <form method="post" class="profile-form">
            {% csrf_token %}
            
            <!-- Current password field -->
            <div class="input-group">
                <label for="{{ form.old_password.id_for_label }}" class="input-label">
                    <span class="label-icon">🔐</span>
                    Current Password
                </label>
                <div style="position: relative;">
                    {{ form.old_password }}
                    <span onclick="togglePasswordField('{{ form.old_password.id_for_label }}')" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); cursor: pointer;">👀</span>
                </div>
                <style>
                    #{{ form.old_password.id_for_label }} { padding-right: 40px !important; }
                </style>
                {% if form.old_password.errors %}
                    <div class="error-message">{{ form.old_password.errors }}</div>
                {% endif %}
                <small class="input-help">Enter your current password to verify</small>
            </div>

            <!-- New password field -->
            <div class="input-group">
                <label for="{{ form.new_password1.id_for_label }}" class="input-label">
                    <span class="label-icon">🔑</span>
                    New Password
                </label>
                <div style="position: relative;">
                    {{ form.new_password1 }}
                    <span onclick="togglePasswordField('{{ form.new_password1.id_for_label }}')" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); cursor: pointer;">👀</span>
                </div>
                <style>
                    #{{ form.new_password1.id_for_label }} { padding-right: 40px !important; }
                </style>
                {% if form.new_password1.errors %}
                    <div class="error-message">{{ form.new_password1.errors }}</div>
                {% endif %}
                <small class="input-help">Use at least 8 characters with numbers and letters</small>
            </div>

            <!-- Confirm new password field -->
            <div class="input-group">
                <label for="{{ form.new_password2.id_for_label }}" class="input-label">
                    <span class="label-icon">✔️</span>
                    Confirm New Password
                </label>
                <div style="position: relative;">
                    {{ form.new_password2 }}
                    <span onclick="togglePasswordField('{{ form.new_password2.id_for_label }}')" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); cursor: pointer;">👀</span>
                </div>
                <style>
                    #{{ form.new_password2.id_for_label }} { padding-right: 40px !important; }
                </style>
                {% if form.new_password2.errors %}
                    <div class="error-message">{{ form.new_password2.errors }}</div>
                {% endif %}
                <small class="input-help">Type the same password again to confirm</small>
            </div>

            <!-- Security tip box -->
            <div class="security-tip">
                <strong>🛡️ Password Tips:</strong>
                <ul>
                    <li>Use a mix of uppercase and lowercase letters</li>
                    <li>Include numbers and special characters</li>
                    <li>Make it at least 8 characters long</li>
                    <li>Don't use personal information</li>
                </ul>
            </div>

            <!-- Form buttons -->
            <div class="form-buttons">
                <button type="submit" class="btn-save">
                    <span>🔄</span> Change Password
                </button>
                <a href="{% url 'main_app:profile' %}" class="btn-cancel">
                    <span>❌</span> Cancel
                </a>
            </div>
        </form>
    </div>
</div>

<script>
function togglePasswordField(fieldId) {
    var passwordField = document.getElementById(fieldId);
    if (passwordField.type === 'password') {
        passwordField.type = 'text';
    } else {
        passwordField.type = 'password';
    }
}
</script>
{% endblock %}