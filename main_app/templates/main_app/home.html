{% extends 'main_app/base.html' %}
{% load static %}

{% block content %}
{% if user.is_authenticated %}
    <div class="dashboard">
        {% if user.first_name or user.last_name %}
            <h1>Welcome back, {{ user.first_name }} {{ user.last_name }}! </h1>
        {% else %}
            <h1>Welcome back, {{ user.username }}! </h1>
        {% endif %}

        <!-- overview and quick actions layout -->
        <div class="overview-layout">
            <!-- left side: statistics overview -->
            <div class="stats-section">
                <h3>ðŸ“Š Projects Overview</h3>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-number">{{ total_projects }}</div>
                        <div class="stat-label">Total Projects</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">{{ total_project_tasks }}</div>
                        <div class="stat-label">Project Tasks</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">{{ completed_project_tasks }}</div>
                        <div class="stat-label">Completed Tasks</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">{{ avg_project_progress }}%</div>
                        <div class="stat-label">Projects Progress</div>
                    </div>
                </div>
                
                <h3>ðŸŽ¯ Skills Overview</h3>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-number">{{ total_skills }}</div>
                        <div class="stat-label">Total Skills</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">{{ total_skill_tasks }}</div>
                        <div class="stat-label">Skill Tasks</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">{{ completed_skill_tasks }}</div>
                        <div class="stat-label">Completed Tasks</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">{{ avg_skill_progress }}%</div>
                        <div class="stat-label">Skills Progress</div>
                    </div>
                </div>
            </div>

            <!-- right side: quick actions -->
            <div class="quick-actions">
                <h3>Quick Actions</h3>
                <a href="{% url 'main_app:skill_create' %}" class="btn-primary">Add New Skill</a>
                <a href="{% url 'main_app:project_create' %}" class="btn-primary">Add New Project</a>
                <a href="{% url 'main_app:skills_list' %}" class="btn-secondary">View All Skills</a>
                <a href="{% url 'main_app:projects_list' %}" class="btn-secondary">View All Projects</a>
            </div>
        </div>

        <!-- preview lists -->
        <div class="preview-sections">
            <div class="preview-section">
                <h3>Recent Skills</h3>
                {% if skills %}
                    {% for skill in skills %}
                        <div class="preview-item">
                            <a href="{% url 'main_app:skill_detail' skill.id %}">{{ skill.title }}</a>
                            <span class="progress-badge">{{ skill.progress }}%</span>
                        </div>
                    {% endfor %}
                    <a href="{% url 'main_app:skills_list' %}" class="view-all">View All â†’</a>
                {% else %}
                    <p>No skills yet. <a href="{% url 'main_app:skill_create' %}">Add your first skill!</a></p>
                {% endif %}
            </div>

            <div class="preview-section">
                <h3>Recent Projects</h3>
                {% if projects %}
                    {% for project in projects %}
                        <div class="preview-item">
                            <a href="{% url 'main_app:project_detail' project.id %}">{{ project.title }}</a>
                            <span class="progress-badge">{{ project.progress }}%</span>
                        </div>
                    {% endfor %}
                    <a href="{% url 'main_app:projects_list' %}" class="view-all">View All â†’</a>
                {% else %}
                    <p>No projects yet. <a href="{% url 'main_app:project_create' %}">Add your first project!</a></p>
                {% endif %}
            </div>
        </div>
    

        <!-- recent activity -->
        {% if recent_reflections %}
        <div class="recent-activity">
            <h3>Recent Reflections</h3>
            {% for reflection in recent_reflections %}
                <div class="activity-item">
                    <p>"{{ reflection.content|truncatewords:15 }}"</p>
                    <small>
                        {% if reflection.skill %}
                            on {{ reflection.skill.title }} - {{ reflection.date|date:"M j" }}
                        {% elif reflection.project %}
                            on {{ reflection.project.title }} - {{ reflection.date|date:"M j" }}
                        {% endif %}
                    </small>
                </div>
            {% endfor %}
        </div>
        {% endif %}

    </div>
    
    {% else %}
    <!-- non-authenticated users -->
    <div class="landing">
        <div class="landing-logo">
            <img src="{% static 'images/logo.png' %}" alt="SkillHub" class="landing-logo-img">
        </div>
        <h1>Welcome to SkillHub</h1>
        <p>Track your skills, manage projects, and reflect on your learning journey.</p>
        <div class="auth-actions">
            <a href="{% url 'main_app:signup' %}" class="btn-primary">Get Started</a>
            <a href="{% url 'main_app:login' %}" class="btn-secondary">Login</a>
        </div>
    </div>
    
{% endif %}
{% endblock %}